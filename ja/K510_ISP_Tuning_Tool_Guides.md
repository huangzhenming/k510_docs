![](../zh/images/canaan-cover.png)

**<font face="黑体" size="6" style="float:right">K510 ISPチューニングツールガイド</font>**

<font face="黑体"  size=3>ドキュメントのバージョン: V1.0.0</font>

<font face="黑体"  size=3>発売日:2022-03-31</font>

<div style="page-break-after:always"></div>

<font face="黑体" size=3>**免責事項**</font>
お客様が購入した製品、サービス、または機能は、北京Jiayuan Jetts情報技術有限公司(以下「当社」、以下同じ)の商業契約および条件の対象となり、本書に記載されている製品、サービス、または機能の全部または一部がお客様の購入または使用の範囲外となる場合があります。 契約に別段の定めがない限り、当社は、本書の記述、情報、内容の正確性、信頼性、完全性、マーケティング、特定目的、非攻撃性について、明示または黙示を問わず、いかなる表明または保証も行いません。 特に断りのない限り、このドキュメントは使用ガイダンスの参照としてのみ使用してください。
このドキュメントの内容は、製品バージョンのアップグレードまたはその他の理由により、予告なく随時更新または変更されることがあります。

**<font face="黑体"  size=3>商標表示</font>**

「<img src="../zh/images/canaan-logo.png" style="zoom:33%;" />」アイコン、カナン、その他の商標は、北京Jiayuan Jets情報技術有限公司の商標です。 本書で言及されるその他すべての商標または登録商標は、それぞれの所有者が所有しています。

**<font face="黑体"  size=3>©著作権2022北京Jiayuan Jetth情報技術有限公司</font>**
このドキュメントは、K510プラットフォーム開発設計にのみ適用され、当社の書面による許可なく、いかなるユニットまたは個人も、このドキュメントの一部または全部をいかなる形式でも配布することはできません。

**<font face="黑体"  size=3>北京Jiayuan Jetth情報技術有限公司</font>**
URL: canaan-creative.com
ビジネスお問い合わせ:salesAI@canaan-creative.com

<div style="page-break-after:always"></div>
# 序文
**<font face="黑体"  size=5>ドキュメントの目的</font>**
このドキュメントは、ISP Tuning Tool の説明ドキュメントです。

**<font face="黑体"  size=5>リーダー オブジェクト</font>**

このドキュメントの主な対象読者は、経験豊富なソフトウェア エンジニア、画像アルゴリズム エンジニア、システム設計者、およびシステム インテグレーターで、プライベート アプリケーションとドライバーを実装したいと考えています。

**<font face="黑体"  size=5>レコードを改訂します</font>**
 <font face="宋体"  size=2>リビジョン レコードには、ドキュメントが更新されるたびに説明が蓄積されます。 ドキュメントの最新バージョンには、以前のすべてのバージョンの更新が含まれています。 </font>

| バージョン番号   | 変更者     | 改訂日 | 修正の説明 |
|  :-----  |-------   |  ------  |  ------  |
| V1.0.0 | システム ソフトウェア グループ | 2022-03-31 | SDK V1.6 リリース |

<div style="page-break-after:always"></div>
**<font face="黑体"  size=6>目録</font>**

[目次]

<div style="page-break-after:always"></div>

# ISP チューニング ツール フレームワークの概要

このセクションでは、ISP イメージ全体の最適化を制御する上位プロセッサ用の ISP チューニング ツールとデータ フローについて説明します。

```text
+----------------------------------------------------+
|                                                    |
|                      K510                          |
|                                                    |
|    +-------+        +--------------------------+   |
|    |       |        |                          |   |
|    |  ISP  +------> |   v4l2_drm_isptool.out   |   |
|    |       |        |                          |   |
|    +-------+        +-------------+------------+   |
|                                   |                |
|                                   |                |
|    +-----------------+            |                |
|    |                 |            |                |
|    |   isp-tuningd   | <----------+                |
|    |                 |                             |
|    +^-+--------------+                             |
|     | |                                            |
|     | |                                            |
+----------------------------------------------------+
      | |
      | |
+-------------------------------+
|     | |                       |
|     | |       PC              |
|     | |                       |
|    ++-v------------------+    |
|    |                     |    |
|    |  ISP Tuning Tool    |    |
|    |                     |    |
|    +---------------------+    |
|                               |
+-------------------------------+
```

## ツール データ フローをチューニングします

通信プロトコルは、クライアント コード ウェアハウスのドキュメントを参照し、ツールは、PC 上で実行されるクライアント isp-tuningd、/app/mediactl_lib/isp-tuningd、および K510 で実行されるサービス側の 2 つの部分で構成されます。 通信はデフォルトで TCP の 9982 ポートを使用します。

### クライアント

ISP Tuning Tool は、PC 上で実行されるアプリケーションです。 AWBキャリブレーションとCCMキャリブレーションは、レジスタの設定に加えてサポートされています。

### サービス側

isp-tuningd は、標準入力から3133440 バイトの yuv イメージ (NV12) を受信し、すべてのクライアントにブロードキャストし、v4l2_drm_isptoolを使用して、isp-tuningd を自動的に起動し、v4l2_drmと一致する方法で画像データを送信します。 次のようなコマンドで実行できます

```shell
cd /app/mediactl_lib
./v4l2_drm_isptool -f video_drm_1080x1920.conf
```

# ISP は、好み項目を呼び出します

K510 ISP には、制御とチューニングのために多数のレジスタとテーブルが用意されています。 ISP ハードウェア レジスタの設定は、画質にとって非常に重要です。 現在、K510プラットフォームは、画像チューニングプロセスはTCP Socketを介してのみ実装されています。

## チューニング ツールのメイン ウィンドウ

このセクションでは、チューニング ウィンドウのこれらのパネルの機能について説明します。

図 3-1 は、チューニング ウィンドウの操作パネル全体を示しています

- パネル 1 は**メニューであり**、構成された ISP ファイルをロードするか、キャリブレーションを行うかを選択できます。
- パネル2は**、開発**ボードのIPアドレスとポート番号(デフォルト9982ポート)を入力した後、緑色の接続ボタンをクリックして接続するための接続コントロールパネルです。
- パネル3は**レジスタパネルであり**、レジスタを設定または読み取る必要がある場合は、このパネルを使用して設定および読み取ることができます。
- パネル4は、調整**パラメータ選択パネルであり**、ユーザは、パネルプロンプトテキストに基づいて様々なパラメータまたはパラメータグループを選択でき、これらの選択されたレジスタは、パネル5に表示される。
- パネル5は、**チューニング**サーバからパラメータ値を設定または取得するためのチューニングパラメータ設定パネルである。
- パネル6は、ISPが出力する画像を表示する**画像表示パネルであり**、再生する必要がない場合には、中央の一時停止ボタンをクリックすることができる。

![図 3-1 チューニング ツールのメイン ウィンドウ](../zh/images/sdk_application/clip_image033.png)

ISP Tuning Tool は、接続後****にすべてのレジスタ値を自動的に取得せず、すべてのレジスタ値を取得する必要がある場合は、**接続コントロール パネル**の右側にある [読み取り] ボタンをクリックして、現在のすべてのレジスタ値をプルできます。

# キャリブレーション > キャリブレーション

このセクションでは、自動ホワイトバランス(AWB)、カラー補正マトリックス(CCM)、ガンマ、レンズシェーディング(LSC)など、ISP チューニングツールを使用したキャリブレーションとキャリブレーションの説明について説明します。

## ティッカー

### 準備作業

1. 標準的なD65光源が付いている標準的なライトボックス
2. 標準の24色カードで、現在はX-RITEカラーカードのみがサポートされています
3. キャリブレーションカメラを準備し、sensorオリジナル画像または処理後の画像を出力します
4. ISPはまた、黒レベル補正とデモザイクアルゴリズムモジュールのみをオンにし、CSCおよびその他のフォーマット変換モジュールは、対称性(行列は逆行列)に注意を払う必要があり、また、ノイズリダクション、シャープネスおよび他のモジュールはほとんど影響しませんが、非線形モジュールとカラー処理モジュール(GAMMA、ワイドダイナミクス、AWB、CCM、彩度調整など)は、できるだけオフにする必要があります

### イメージを取得します

1. カメラは24色カードを位置合わせし、24色のカードが画面全体を満たしていることを確認し、画像をキャプチャし、次の図に示すように、正確なクリックで再生を一時停止できることを保証しません

    ![図 4-1 24 カラー カードの撮影](../zh/images/sdk_application/clip_image014.jpg)

2. キャプチャされたイメージは、明るいか暗いかに注意し、明るすぎると暗すぎるとキャリブレーションに影響します

### 較正

メニューバーの「Calibration」をタップし、「AWB」を選択してキャリブレーションを実行し、プログラムは自動的にカラーカードを選択します

![図 4-2 自動ボックス カラー カード](../zh/images/sdk_application/clip_image016.jpg)

この時点で任意のキーを押して続行し、ホワイトバランスが完了した後の画像をポップします

![図 4-3 AWB キャリブレーションを完了します](../zh/images/sdk_application/clip_image018.jpg)

問題がなければ、任意のキーを押し続けると、ツールはダイアログボックスをポップアップしてパラメータが妥当かどうかを尋ね、メインインターフェイス関連レジスタに入力するか、キャリブレーション結果を破棄し、そうでない場合はデバイスレジスタに書き込むかどうかを尋ねます。

## ティッカ ー

AWB キャリブレーションと一致し、説明を省略します。

## ガンマ

標準的なガンマ曲線の式は、
$$
Y=aX^b
$$
ここで、$b$はGamma係数であり、撮像側では一般に1未満であり、表示側では一般に1より大きい。 $a$の値は$b$の値から計算できます

$$
a=\frac{256}{256^b}
$$
この式の原理は、入力が256であり、ガンマ矯正が完了した後、まだ256である。

ガンマ係数bが0.5の場合,曲線は下図のようになる

![](../zh/images/sdk_application/clip_image025.png)

## ティッ カー

### 準備作業

- 1つのショットで得られたRAW形式の写真を撮る

### 原理

レンズの中心が周囲の光量と一致しないため、画像の輝度が不均一になり、カーブフィットによって補正サーフェスが生成され、この問題が解決されます。

矯正前の図を以下に示します

![補正前](../zh/images/sdk_application/clip_image029.png)

矯正後の図を以下に示す

![補正後](../zh/images/sdk_application/clip_image031.png)

**免責事項を翻訳します**  
お客様の便宜のために、カナアンはAI翻訳プログラムを使用してテキストを複数の言語に翻訳し、エラーが含まれている可能性があります。 当社は、提供される翻訳の正確性、信頼性、または適時性を保証するものではありません。 カナアンは、翻訳された情報の正確性または信頼性への依存に起因するいかなる損失または損害についても責任を負いません。 異なる言語翻訳間でコンテンツの違いがある場合は、簡体字中国語版が優先されます。

翻訳エラーや不正確な問題を報告する場合は、メールでお問い合わせください。
